<!-- includes/client-notifications.html -->
<div class="p-4">
  <h2 class="text-xl font-bold mb-4">Notifications</h2>
  <div id="client-notifications-list" class="space-y-2"></div>
</div>

<script>
(async function(){
  const container = document.getElementById('client-notifications-list');
  try {
    const res = await fetch('/backend/includes/client_notifications.php', { credentials:'include' });
    const notifs = await res.json();
    if (!Array.isArray(notifs) || notifs.length === 0) {
      container.innerHTML = '<div class="text-muted p-2">No notifications</div>'; return;
    }
    container.innerHTML = notifs.map(n => `
      <div class="p-2 bg-white/3 rounded flex justify-between items-start">
        <div>
          <div class="font-semibold">${n.title || 'Notification'}</div>
          <div class="text-sm">${n.message}</div>
          <div class="text-xs text-muted">${n.date}</div>
        </div>
        <div><button class="px-2 py-1 rounded bg-green-600 markRead" data-id="${n.notification_id}">Mark read</button></div>
      </div>
    `).join('');
    document.querySelectorAll('.markRead').forEach(btn => btn.addEventListener('click', async (e)=>{
      const id = e.target.dataset.id;
      const r = await fetch('/backend/includes/mark_notification_read.php', {
        method:'POST', credentials:'include', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id})
      });
      if (r.ok) { e.target.closest('div').remove(); }
    }));
  } catch(err) {
    container.innerHTML = `<div class="text-red-400 p-2">Error: ${err.message}</div>`;
  }
})();
</script>
