<main class="max-w-6xl mx-auto p-8 text-gray-100 fade-in">
  <header class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-semibold flex items-center gap-2 text-white">
      <i class="fas fa-users text-purple-400"></i> Teams Management
    </h1>
    <button id="newTeamBtn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-xl font-medium">+ New Team</button>
  </header>

  <!-- Team List -->
  <section>
    <div id="teamsContainer" class="grid md:grid-cols-2 gap-6"></div>
  </section>

  <!-- Modal -->
  <div id="teamModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-gray-900 p-6 rounded-2xl w-full max-w-md border border-gray-700 shadow-2xl">
      <h2 id="modalTitle" class="text-xl font-semibold mb-4 text-purple-300">Create Team</h2>
      <form id="teamForm" class="space-y-4">
        <div>
          <label class="block mb-1 text-sm text-gray-400">Team Name</label>
          <input name="team_name" type="text" class="w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-100" required />
        </div>
        <div>
          <label class="block mb-1 text-sm text-gray-400">Manager</label>
          <select name="manager_id" id="managerSelect" class="w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-100"></select>
        </div>
        <div>
          <label class="block mb-1 text-sm text-gray-400">Description</label>
          <textarea name="description" rows="3" class="w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-100"></textarea>
        </div>
        <div class="flex justify-end gap-3 mt-4">
          <button type="button" id="cancelModal" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700">Save</button>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const api = '../../backend/api/teams.php';
  const teamsContainer = document.getElementById('teamsContainer');
  const modal = document.getElementById('teamModal');
  const cancelModal = document.getElementById('cancelModal');
  const newTeamBtn = document.getElementById('newTeamBtn');
  const form = document.getElementById('teamForm');
  const managerSelect = document.getElementById('managerSelect');

  async function loadTeams() {
    const res = await fetch(api + '?action=list');
    const data = await res.json();
    if (!data.success) return;
    teamsContainer.innerHTML = data.teams.map(t => `
      <div class="bg-gray-800 p-5 rounded-xl border border-gray-700 hover:shadow-lg transition">
        <h3 class="text-lg font-semibold text-purple-300 mb-1">${t.team_name}</h3>
        <p class="text-sm text-gray-400 mb-2">${t.description || 'No description'}</p>
        <div class="flex justify-between text-sm text-gray-400">
          <span>Manager: ${t.manager_name}</span>
          <span>${t.member_count} members</span>
        </div>
        <button onclick="viewMembers(${t.team_id})" class="mt-3 text-sm text-purple-400 hover:underline">View Members</button>
      </div>
    `).join('') || `<p class="text-gray-500">No teams found.</p>`;
  }

  async function loadManagers() {
    const res = await fetch(api + '?action=dropdownData');
    const data = await res.json();
    managerSelect.innerHTML = data.managers.map(m => `<option value="${m.user_id}">${m.name}</option>`).join('');
  }

  newTeamBtn.onclick = () => { modal.classList.remove('hidden'); form.reset(); };
  cancelModal.onclick = () => modal.classList.add('hidden');

  form.onsubmit = async (e) => {
    e.preventDefault();
    const res = await fetch(api + '?action=create', { method: 'POST', body: new FormData(form) });
    const data = await res.json();
    if (data.success) {
      modal.classList.add('hidden');
      await loadTeams();
    } else alert(data.message);
  };

  window.viewMembers = async (id) => {
    const res = await fetch(api + '?action=members&team_id=' + id);
    const data = await res.json();
    if (data.success) {
      alert("Members:\n" + data.members.map(m => `â€¢ ${m.name} (${m.role})`).join('\n'));
    }
  };

  loadTeams();
  loadManagers();
});
</script>
